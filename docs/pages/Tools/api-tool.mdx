---

title: 🗝️ 通用 API 工具
description: 了解如何配置和使用 DocsGPT 中的 API 工具，无需编写自定义代码即可连接任何 RESTful API。
---

import { Callout } from 'nextra/components';
import Image from 'next/image';

# 使用通用 API 工具

API 工具提供了一种无代码/低代码解决方案，使 DocsGPT 能够与第三方或内部 RESTful API 进行交互。它充当桥梁，让大语言模型(LLM)能够基于您的聊天对话调用外部服务。本指南将带您了解其功能、配置和最佳实践。

## 通用 API 工具简介

**适用场景：**

* 适合快速集成标准 HTTP 请求(GET、POST、PUT、DELETE)的现有 API
    * 适用于获取数据以丰富回答内容(例如当前天气、股票价格、产品详情)
    * 可用于触发其他系统中的简单操作(例如发送通知、创建基础任务)

**与自定义 Python 工具的对比：**

* **API 工具：** 最适合简单的 API 调用，通过 DocsGPT 界面即可完成配置
    * **自定义 Python 工具：** 当您需要在 API 调用前后执行复杂逻辑、处理非标准认证(如复杂的 OAuth 流程)、管理多步骤 API 交互，或需要进行 LLM 难以单独处理的复杂数据处理时更为适用。详情请参阅[创建自定义工具](/Tools/creating-a-tool)

## API 工具功能

**支持的 HTTP 方法:** 您可以使用以下标准 HTTP 方法配置操作：

* `GET`: 用于获取数据
    * `POST`: 用于提交数据以创建新资源
    * `PUT`: 用于更新现有资源
    * `DELETE`: 用于删除资源

**请求配置:**

* **请求头:** 定义静态或动态 HTTP 头，用于身份验证（如 API 密钥）、内容类型指定等
    * **查询参数:** 指定 URL 查询参数，这些参数可以是静态的，也可以由 LLM 根据用户输入动态填充
    * **请求体:** 定义请求体结构（如 JSON），其中字段可以是静态的或由 LLM 动态填充

**响应处理:**

* API 工具执行请求并接收来自 API 的原始响应（通常是 JSON 或纯文本）
    * 该原始响应随后传回给 LLM
    * LLM 利用此响应，结合您的查询上下文和 API 工具操作的描述，来构建答案或决定后续操作。API 工具本身不会对响应进行深度解析或转换，仅执行基本的内容类型检测（例如将 JSON 加载为可解析对象）

## 将 API 配置为工具

您可以通过 DocsGPT 用户界面配置 API 工具，路径为**设置 -> 工具**。添加或修改 API 工具时，您需要定义 DocsGPT 可执行的具体操作。

<Callout type="info">
  配置过程涉及定义 DocsGPT 如何调用 API 端点。每个配置好的 API 调用本质上都会成为 LLM 可选择使用的独立"操作"。
</Callout>

以下是一个配置 API 操作的示例，灵感来源于设置电话号码验证服务：

<Image
  src="/toolIcons/api-tool-example.png"
  alt="API Tool configuration example for phone validation"
  width={800}
  height={450}
  style={{ margin: '1em auto', display: 'block', borderRadius: '8px' }}
/>

_图1：用于验证电话号码的 API 工具操作配置示例。_

**定义 API 端点/操作：**

配置新的 API 操作时，您需要填写以下字段：

-   **`Name`（名称）:** 为该API操作指定一个用户友好的名称（例如示例中的"Phone-check"，或更具体的"ValidateUSPhoneNumber"）。这有助于管理您的工具集。
-   **`Description`（描述）:** 这是**关键字段**。需清晰简洁地说明该API操作的功能、预期输入类型（隐式说明）以及输出结果。LLM将根据此描述理解何时及如何使用该操作。
-   **`URL`:** API请求的完整端点URL。
-   **`HTTP Method`（HTTP方法）:** 从下拉菜单中选择适当的HTTP方法（如GET、POST）。
-   **`Headers`（请求头）:** 可以添加自定义HTTP头作为键值对（名称，值）。需指明该值应由`LLM填充`还是静态值。若由LLM填充，需为此参数提供`Description`说明。

-   **`Query Parameters`（查询参数）:** 适用于`GET`请求或通过URL传递参数的情况。
    * **`Name`（名称）:** 查询参数名称（如`api_key`、`phone`）。
    * **`Type`（类型）:** 参数数据类型（如`string`）。
    * **`Filled by LLM`（由LLM填充）(复选框):**
        - **未勾选（静态值）:** 每次调用将使用您提供的`Value`（例如固定不变的`api_key`）。
        - **已勾选（动态值）:** LLM将根据您为该参数提供的`Description`，从用户聊天内容中提取合适值。若勾选此项，`Value`字段通常留空或包含占位符。
    * `Description`（描述）: 若参数需动态填充，则为LLM提供上下文说明；若为静态参数，则作为您的参考说明。
    * `Value`（值）: 若非LLM填充，则填写静态值。

-   **`Request Body`（请求体）:** 用于向API发送数据（通常为JSON）。与查询参数类似，您需要定义字段的`Name`、`Type`、是否由`LLM填充`、动态字段的`Description`说明，以及适用的静态`Value`。

**LLM 响应处理指南**

虽然 API 工具配置界面没有明确定义响应解析规则的字段（如 JSONPath 提取器），但您可以通过以下方式显著影响 LLM 对响应的处理：

* **工具操作 `Description`:** 明确说明 API 返回的信息类型（例如："此 API 返回一个包含电话号码 'status' 和 'location' 字段的 JSON 对象"）。这有助于 LLM 识别 API 输出中的关键信息。
    * **提示词工程:** 对于更复杂的场景，您可能需要调整全局或特定代理的提示词，以指导 DocsGPT 如何解释和呈现来自 API 工具响应的信息。参见[自定义提示词](/Guides/Customising-prompts)。

## 在聊天中使用配置好的 API 工具

一旦 API 操作配置完成并启用，DocsGPT 的 LLM 可以根据您的自然语言查询决定是否使用它。

**示例（基于图 1 中的电话验证工具）：**

1. **用户查询**："嘿 DocsGPT，你能检查 +14155555555 是否是一个有效的电话号码吗？"

2. **DocsGPT (LLM 编排)**:
    * 大语言模型分析查询内容
    * 将查询意图（"检查...是否为有效电话号码"）与 "Phone-check" API 操作的描述进行匹配
    * 识别出 `+14155555555` 作为 `phone` 参数的值（该参数标记为 `由LLM填充`，描述为"待验证的电话号码"）
    * DocsGPT 构建 GET API 请求

3. **API 工具执行**:
    * API 工具发起 HTTP GET 请求
    * 外部 API (AbstractAPI) 处理请求并返回 JSON 响应，例如：
        ```json
        {
          "phone": "+14155555555",
          "valid": true,
          "format": {
            "international": "+1 415-555-5555",
            "national": "(415) 555-5555"
          },
          "country": {
            "code": "US",
            "name": "United States",
            "prefix": "+1"
          },
          "location": "California",
          "type": "Landline"
        }
        ```

4. **DocsGPT 响应生成**:
    * API 工具将 JSON 响应传回大语言模型
    * 大语言模型根据工具描述和用户原始查询，提取相关信息并生成用户友好的回答
    * **DocsGPT 聊天响应**: "是的，+14155555555 似乎是美国加利福尼亚州的一个有效座机号码。"

## 高级技巧与最佳实践

**清晰的描述是关键：** LLM 高度依赖 API 操作的 `Description` 字段及其参数描述。确保这些描述明确且以行动为导向。清晰说明工具的功能以及预期的输入类型（即使是通过参数描述隐式表达）。

**迭代测试：** 配置完 API 工具后，使用不同措辞的用户查询进行测试，确保 LLM 能正确触发该工具并按预期解析响应。

**错误处理：**

* 如果 API 调用失败，API 工具将返回来自 `requests` 库或 API 本身的错误消息和状态码。LLM 可能会转发此错误或尝试解释它。
    * 若遇到问题，可查看 DocsGPT 的后端日志获取更详细的错误信息。

**安全注意事项：**

* **API 密钥：** 注意 API 密钥和其他敏感凭证。示例图片中直接在配置里显示了 API 密钥。对于生产环境或共享环境，应避免暴露包含敏感密钥的配置。
    * **速率限制：** 注意所集成 API 的调用频率限制。来自 DocsGPT 的频繁调用可能会超出这些限制。
    * **数据隐私：** 考虑将用户查询数据发送至第三方 API 时的数据隐私影响。

-   **幂等性**：对于修改数据的工具（POST、PUT、DELETE），需注意 API 操作是否具有幂等性，以避免因 LLM 重试操作导致重复调用产生意外后果。

## 局限性

尽管功能强大，通用 API 工具仍存在一些限制：

-   **复杂认证**：高级认证流程（如需要用户重定向的三方 OAuth 2.0 或基于自定义签名的认证）通常需要定制 Python 工具。
-   **多步骤 API 交互**：若任务需要多个相互依赖的 API 调用（例如先获取列表，再逐项获取详情），这类复杂链式逻辑更适合通过定制 Python 工具处理。
-   **复杂数据转换**：若 API 响应需经重大转换或处理才能被 LLM 使用，定制 Python 工具能提供更高灵活性。
-   **实时流传输（SSE、WebSockets）**：该工具设计用于请求-响应交互，不支持维持持久流连接。

若使用场景超出上述限制，建议开发[自定义 Python 工具](/Tools/creating-a-tool)。