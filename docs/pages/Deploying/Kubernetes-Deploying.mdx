---

title: 在 Kubernetes 上部署 DocsGPT
description: 学习如何在 Kubernetes 集群上自托管 DocsGPT，实现可扩展且稳健的部署方案。
---

# 自托管 DocsGPT

于 Kubernetes 环境

本指南将引导您完成在 Kubernetes 上部署 DocsGPT 的全过程。

## 前置条件

开始前请确保已安装以下工具：

- [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/)
- 可访问的 Kubernetes 集群

## 目录结构

`deployment/k8s` 目录包含必需的部署和服务配置文件：

- `deployments/`
- `services/`
- `docsgpt-secrets.yaml`

## 部署指南

1. **克隆代码仓库**

   ```sh
   git clone https://github.com/arc53/DocsGPT.git
   cd docsgpt/deployment/k8s
   ```

2. **配置密钥（可选）**

   确保 `docsgpt-secrets.yaml` 文件中包含所有必要的密钥。如需自定义，请在应用前更新该文件。默认情况下，我们将使用 qdrant 作为向量存储，并使用公共的 docsgpt llm 进行推理。

3. **应用 Kubernetes 部署**

   使用以下命令部署 DocsGPT 资源：

   ```sh
   kubectl apply -f deployments/
   ```

4. **应用 Kubernetes 服务**

   通过以下命令设置服务：

   ```sh
   kubectl apply -f services/
   ```

5. **应用密钥配置**

   应用密钥配置文件：

   ```sh
   kubectl apply -f docsgpt-secrets.yaml
   ```

6. **替换 API 地址**

   部署服务后，您需要在部署文件 `deployments/docsgpt-deploy.yaml` 中将环境变量 `VITE_API_HOST` 更新为由 `docsgpt-api-service` 创建的实际端点 URL。

    ```sh
    kubectl get services/docsgpt-api-service -o jsonpath='{.status.loadBalancer.ingress[0].ip}' | xargs -I {} sed -i "s|<your-api-endpoint>|{}|g" deployments/docsgpt-deploy.yaml
    ```

7. **重新运行部署**

   完成更改后，重新应用部署配置以更新环境变量：

   ```sh
   kubectl apply -f deployments/
   ```

## 验证部署

要验证是否所有配置都正确完成，可以运行以下命令：

```sh
kubectl get pods
kubectl get services
```

确保所有 Pod 都处于运行状态且服务可用。

## 访问 DocsGPT

要访问 DocsGPT，需要找到前端服务的外部 IP 地址。可通过运行以下命令获取：

```sh
kubectl get services/docsgpt-frontend-service | awk 'NR>1 {print "http://" $4}'
```

## 故障排除

如果遇到任何问题，可以查看 Pod 日志获取详细信息：

```sh
kubectl logs <pod-name>
```

将 `<pod-name>` 替换为你实际的 DocsGPT Pod 名称。